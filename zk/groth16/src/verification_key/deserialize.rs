use serde::Deserialize;

use crate::{
    curve::Curve,
    protocol::Protocol,
    utils::{JsonG1, JsonG2},
};

#[derive(Deserialize)]
pub struct VerificationKeyJsonDeser {
    pub protocol: Protocol,
    pub curve: Curve,
    #[serde(alias = "vk_alpha_1")]
    pub alpha_1: JsonG1,
    #[serde(alias = "vk_beta_2")]
    pub beta_2: JsonG2,
    #[serde(alias = "vk_gamma_2")]
    pub gamma_2: JsonG2,
    #[serde(alias = "vk_delta_2")]
    pub delta2: JsonG2,
    #[serde(alias = "IC")]
    pub ic: Vec<JsonG1>,
}

#[cfg(test)]
mod tests {
    use std::{ops::Deref as _, sync::LazyLock};

    use serde_json::{Value, json};

    use super::*;

    pub static VK: LazyLock<Value> = LazyLock::new(|| {
        json!({
          "protocol": "groth16",
          "curve": "bn128",
          "nPublic": 8,
          "vk_alpha_1": [
            "20491192805390485299153009773594534940189261866228447918068658471970481763042",
            "9383485363053290200918347156157836566562967994039712273449902621266178545958",
            "1"
          ],
          "vk_beta_2": [
            [
              "6375614351688725206403948262868962793625744043794305715222011528459656738731",
              "4252822878758300859123897981450591353533073413197771768651442665752259397132"
            ],
            [
              "10505242626370262277552901082094356697409835680220590971873171140371331206856",
              "21847035105528745403288232691147584728191162732299865338377159692350059136679"
            ],
            [
              "1",
              "0"
            ]
          ],
          "vk_gamma_2": [
            [
              "10857046999023057135944570762232829481370756359578518086990519993285655852781",
              "11559732032986387107991004021392285783925812861821192530917403151452391805634"
            ],
            [
              "8495653923123431417604973247489272438418190587263600148770280649306958101930",
              "4082367875863433681332203403145435568316851327593401208105741076214120093531"
            ],
            [
              "1",
              "0"
            ]
          ],
          "vk_delta_2": [
            [
              "10857046999023057135944570762232829481370756359578518086990519993285655852781",
              "11559732032986387107991004021392285783925812861821192530917403151452391805634"
            ],
            [
              "8495653923123431417604973247489272438418190587263600148770280649306958101930",
              "4082367875863433681332203403145435568316851327593401208105741076214120093531"
            ],
            [
              "1",
              "0"
            ]
          ],
          "vk_alphabeta_12": [
            [
              [
                "2029413683389138792403550203267699914886160938906632433982220835551125967885",
                "21072700047562757817161031222997517981543347628379360635925549008442030252106"
              ],
              [
                "5940354580057074848093997050200682056184807770593307860589430076672439820312",
                "12156638873931618554171829126792193045421052652279363021382169897324752428276"
              ],
              [
                "7898200236362823042373859371574133993780991612861777490112507062703164551277",
                "7074218545237549455313236346927434013100842096812539264420499035217050630853"
              ]
            ],
            [
              [
                "7077479683546002997211712695946002074877511277312570035766170199895071832130",
                "10093483419865920389913245021038182291233451549023025229112148274109565435465"
              ],
              [
                "4595479056700221319381530156280926371456704509942304414423590385166031118820",
                "19831328484489333784475432780421641293929726139240675179672856274388269393268"
              ],
              [
                "11934129596455521040620786944827826205713621633706285934057045369193958244500",
                "8037395052364110730298837004334506829870972346962140206007064471173334027475"
              ]
            ]
          ],
          "IC": [
            [
              "12435027896306279335193308081547588397707908354296203708986426498811137282805",
              "1442224100712712328150106930749826054966358757418009409064262428311438297589",
              "1"
            ],
            [
              "6735289222268620887967101274979053291171490931365310833145702788124436306172",
              "9508959186325531371812230880333707564381251143253667590318797673905874656876",
              "1"
            ],
            [
              "18473388283757542137959421863159345574612491564845354899214639118208041462528",
              "18694560805112314918061014137720005546519432757072656793585858269938858875786",
              "1"
            ],
            [
              "14967980733094356746724483499152644406535805007874369203174937895115670061148",
              "21728985130787642996653019574511069426374543279373944744758299867225875316207",
              "1"
            ],
            [
              "2382193504388354063042061240913607011189297257126245603646126957113028251067",
              "3186788563303315565192587592243750128841672669733123922563414054674374354455",
              "1"
            ],
            [
              "18815251261767293524033866532395010820316526629864592538806627807808874450256",
              "14404431525267621164746248685134916870545882017438687959827868761075391115140",
              "1"
            ],
            [
              "2878782699870421548853699842350275130789491211417932280378631526118618555825",
              "13892724600248241307159136198318007050224821820754006064007333455611109868450",
              "1"
            ],
            [
              "579707933191239712100492334635245879466181955226065917287512793704772026173",
              "1238995256577015863996826154249942452365261008855283188563957554395031762036",
              "1"
            ],
            [
              "14018877585297879644865038142378378343065417965038921806374979044606559378166",
              "19185248721619886855032100865444975713606706368794309022191613560536985285760",
              "1"
            ]
          ]
        })
    });
    #[test]
    fn test_deserialize() {
        let _: VerificationKeyJsonDeser = serde_json::from_value(VK.deref().clone()).unwrap();
    }
}
